/*! hm.js v1.0.0 Â© Fred Yang - semanticsworks.com | www.opensource.org/licenses/mit-license.php */(function(h,C,s){function Ab(e,b){for(var a in b)e[a]||(e[a]=b[a])}function Ac(e){return"."===e?"#":(new Za(e.length+2)).join("#")}function Bb(e){if(e===K)return"";var b=Cb.exec(e);return b?b[1].replace($a,ab):e}function ab(e){return"#"==e?".":(new Za(e.length)).join("#")}function bb(e,b,a){var c,d=e.lastIndexOf(".");l(a)&&(a=!0);if(a){-1===d?(a="",c=e):(a=e.substring(0,d),c=e.substring(d+1));d=a;a=c;for(var f=0;f<ia.length;f++)ia[f](d,a,b)}if(!Q(b))for(c in b){d=e;a=c;for(var f=b[c],g=0;g<ia.length;g++)ia[g](d,
a,f);bb(e+"."+c,b[c],!1)}}function Db(e,b){b=L(b);var a=X[b];a||(X[b]=a=[]);a.pushUnique(e)}function Eb(e,b){b=L(b);var a=X[b];a.remove(e);a.length||delete X[b]}function Fb(e){return(e=Bc.exec(e))&&e[1]||""}function ja(){return!1}function D(){return!0}function Ka(e,b,a,c,d){this.publisher=R(e);this.originalPublisher=R(b);this.originalType=this.type=a;this.proposed=c;this.removed=d}function Gb(e){var b=e.handler,a=b.getName,b=b.getParas;e=e.publisher;return b?e[a](b):r(e[a])?e[a]():e[a]}function Hb(e,
b){var a=b.handler,c=a.setName;(a=a.setParas)?this[c](a,e):r(this[c])?this[c](e):this[c]=e}function Ib(e,b,a){var c=ka.getId(b);return h.map(e.split(la),function(b){return m(a)?b+"."+K+"."+c+"."+a:b+"."+K+"."+c+"."+ka.getId(a)}).join(" ")}function R(e){if(m(e))return j(e);if(t(e)&&!e.nodeType)return e;if(!l(e))return h(e)}function Cc(e){return"."==e?"\\.":".*"}function Jb(e){var b,a,c;c=e.publisher.subsToMe();for(a=0;a<c.length;a++){b=c[a];var d=e,f;a:{f=b.eventTypes;var g=e.type,h=void 0,j=void 0,
l=j=h=void 0,ma=void 0;if("*"===f)f="*";else{f=f.split(la);for(ma=0;ma<f.length;ma++)if(j=f[ma],j=(l=Kb.test(j))?j.replace(Kb,""):j,j=j.replace(Dc,Cc),j=l?"^"+j:"^"+j+"$",h=new A(j,"i"),h=h.test(g))if(l){if(l="^"==j?g:A.rightContext,!l||!l.contains(".")){f=f[ma];break a}}else{f=f[ma];break a}f=void 0}}d.matchedType=f;e.matchedType&&La(R(b.subscriber),b.handler,e);if(e.isImmediatePropagationStopped())return}if(!e.isCascadeStopped()&&(b=X[e.publisher.path]))for(c=0;c<b.length;c++){a=w(b[c],e.originalPublisher.path,
e.type);if(a.isImmediatePropagationStopped()||a.isImmediatePropagationStopped())break;a.hasError()&&e.error()}}function La(e,b,a,c){var d;a.handler=b;a.subscriber=e;c=l(c)?b.get.call(e,a):b.get.apply(e,[a].concat(c));if(!a.isAborted())if($(c))d=p(!0,{},a),c.done(function(c){b.convert&&(c=b.convert.call(e,c,a));if(b.set||b.finalize)if($(c))c.done(function(a){Ma(e,b,a,d)});else return Ma(e,b,c,a)});else if(b.convert&&(c=b.convert.call(e,c,a)),b.set||b.finalize)$(c)?(d=p(!0,{},a),c.done(function(a){Ma(e,
b,a,d)})):Ma(e,b,c,a)}function Ma(e,b,a,c){a===na&&(a=s);b.set&&b.set.call(e,a,c);b.finalize&&b.finalize.call(e,a,c)}function Lb(){this.isAborted=D}function oa(e){e.publisher=R(e.currentTarget);e.originalPublisher=R(e.target);e.isAborted=ja;e.abort=Lb;var b=R(e.data.subscriber),a=e.data.handler;delete e.data;1<arguments.length?La(b,a,e,y.call(arguments,1)):La(b,a,e)}function Mb(e,b,a,c){e=e||"";if(m(e)){var d=e,f=d.split(la),g;if(1==f.length)if(d.startsWith("*")){e=aa[d.substr(1)];if(!e)throw"common workflow "+
d+" does not exist";e=p({},e)}else if(d.startsWith("#"))if(e=cb(d,b,a),r(e))e=p({get:e,options:c},e);else if(t(e)&&e.get)e=p({options:c},e);else throw"missing handler";else if(!l(b)&&!l(a))if(e=m(b),f=m(a),e)e={get:"get",set:d||"set"};else if(f)if(d)e={get:d,set:"set"};else if(e=q.raw(a),r(e))e={get:q.raw(a)};else{if(!t(e)||!e.get)throw"missing handler";}else e={get:d,set:d};else throw"invalid handler";else{e={};for(var h=0;h<Na.length;h++)d=f[h],g=Na[h],d&&("_"!==d&&"null"!=d)&&(e[g]=d)}}else if(r(e))e=
p({get:e,options:c},e);else if(t(e)&&e.get)e=p({options:c},e);else throw"invalid workflow expression";f=e;d=f.initialize;if(m(d))if(d.startsWith("*")){if(d=j.activity.initialize[d.substring(1)],!d)throw"initialize activity does not exist!";}else{var u=d;if(!q.raw(u))throw"initialize activity does not exist at path "+u;d=function(a,b,c,d){q.set(u,a,b,c,d)}}d?d(R(b),R(a),f,c):l(c)||(f.options=c);Oa("get",e,b,a);Oa("set",e,b,a);za("convert",e,b,a);za("finalize",e,b,a);return e}function cb(e,b,a){e=e.substr(1);
e=m(a)?G(a,e):m(b)?G(b,e):e;return q.raw(e)}function Nb(e){var b;if(m(e)){var a=e.split(la),c;if(1<a.length){e={};for(var d=0;d<Na.length;d++)b=a[d],c=Na[d],b&&("_"!==b&&"null"!=b)&&(e[c]=b)}else throw"invalid workflow type";b=e}else if(r(e)||t(e)&&e.get)b=e,r(e)&&(b=p({get:e},b));else throw"invalid workflow expression";za("initialize",b);Oa("get",b);Oa("set",b);za("convert",b);za("finalize",b);return b}function Oa(e,b,a,c){var d=b[e];if(d&&m(d)){var f=j.activity[e];if(d.startsWith("*")){if(d=d.substr(1),
b[e]=f[d],!b[e])throw d+" does not exists "+e+" Activity";}else if(d.startsWith("#"))b[e]=cb(d,a,c);else if(d=d.split("*"),b[e]="get"==e?Gb:Hb,b[e+"Name"]=d[0],d[1]&&(b[e+"Paras"]=d[1]),!l(a)&&!l(c)){b=d[0];a="get"==e?a:c;var g;m(a)?M[b]||(g=!0):a.nodeType?pa[b]||(g=!0):b in a||(g=!0);if(g)throw("get"==e?"publisher":"subscriber")+" does not have a member "+b;}}}function za(e,b,a,c){var d=b[e];if(m(d))if(d.startsWith("*")){if(b[e]=j.activity[e][d.substr(1)],!b[e])throw d+"Activity does not exists";
}else if(d.startsWith("#"))b[e]=cb(d,a,c);else throw'activity other than "get" and "set"  must begin with "*" or "#" ';}function Ob(e){if(t(e)){if(!ka.getId(e))return;ka.unMark(e)}H.removeBy(e)}function db(e,b){if("_"!==b)return b&&b.startsWith("_")?b.substr(1):e||b}function Pb(e){if(1===e.nodeType){var b,a,c,d=e.attributes,f=d[n.subsAttr]&&d[n.subsAttr].nodeValue||"";for(b=0;b<d.length;b++)if(a=d[b],a.name!==n.subsAttr){c=a.name;c=c.replace(Ec,"");if(c.startsWith("!")||c.startsWith("$"))c=c.replace(Fc,
" ");c=c.replace(Gc,Hc);if("ns"==c||qa[c])f=f+";"+c+":"+(a.nodeValue||"/");else if(c.startsWith("!")||c.startsWith("$")){a=a.nodeValue.split(";");for(var g=0;g<a.length;g++)f=f+";"+c+":"+a[g]}}e="tag_"+e.tagName;qa[e]&&(f=f+";"+e+":.");return f.replace(/^;/,"")}}function ba(e,b,a,c){var d,f;if(e)if(e.nodeType){if(c=e,e=b||Pb(c)){b=new ba;b.elem=c;a=b;a:{for(c=h(c);(c=c.parent())&&c.length;)if(d=c.hmData("ns"),!l(d)){c=d;break a}c=""}a.ns=c;return new ba(e,b)}}else{if(!b)return b=new ba,b.elem={},
new ba(e,b);this.sub=[];this.pub=[];for(this.bindings=[];f=Ic.exec(e);){var g=f[1],j=h.trim(f[2]);f=h.trim(f[3]);g?this["$"==g?"pub":"sub"].push({eventTypes:j,value:f}):"ns"==j?d=f:this.bindings.push({bindingName:j,value:f})}this.ns=G(G(b.ns,a),d);this.text=e;this.elem=b.elem;b.context?this.context=b.context:(this.context=this,this.dynamicBindings=[],this.subscriptions=[],h(this.elem).hmData("ns",this.ns));this.options=db(b.options,c);this._importBindings();this._importSubscriptions("sub");this._importSubscriptions("pub")}else this.subscriptions=
[]}function eb(e){var b,a,c=h(e);if(!c.hmData("parsed")&&(b=Pb(e))){b=new ba(e,b);e=b.subscriptions;if(a=b.runFirst)a[0](a[1],a[2],a[3],a[4]);var d=b.dynamicBindings;for(a=0;a<d.length;a++){var f=d[a];f[0](f[1],f[2],f[3],f[4])}if(b=b.runLast)b[0](b[1],b[2],b[3],b[4]);for(a=0;a<e.length;a++)b=e[a],j.sub(b.subscriber,b.publisher,b.eventTypes,b.handler,b.options,b.delegate);c.hmData("parsed",!0)}c.children().each(function(){eb(this)})}function z(e,b,a){if(!e)return qa;if(!b){if(t(e)){for(var c in e)z(c,
e[c]);return this}return qa[e]}x(b)&&(b=b.concat(";"));qa[a?"tag_"+e.toUpperCase():e]=b;return this}function Qb(e,b,a,c){q.get(b,e,b,a,c)}function fb(e){return function(){for(var b=0;b<e.length;b++)e[b].apply(this,arguments)}}function Rb(e,b){if(m(e)){if(b){for(var a=1,c=S(e);a<c.length;)N(c[a],c[a-1]),a++;e=c[c.length-1]}var d=e,a=[],c=S(d);if(1===c.length)a=Sb(c[0]);else{for(var f=0;f<c.length;f++)a.push(Sb(c[f]));a=h.when.apply(h,a)}return Pa(a).fail(function(){k.unload(d)})}if(x(e)){for(var a=
e,g=[],j,u={ok:!0},f=0;f<a.length;f++)j=a[f],g.push(j),c=0===f?Rb(j).fail(Tb(j,u)):c.nextLoad(j).fail(Tb(g.slice(),u));return Pa(c)}throw"resource parameter should be an array or string";}function Tb(e,b){return function(){b.ok&&(k.unload(e),b.ok=!1)}}function Sb(e){var b=ra(e);if(b){var a=T(e);a||(a=b.load(e),b.noRefCount||T(e,a));"staticLoaded"!==a.refCount&&(a.refCount=a.refCount?a.refCount+1:1);return a}return k.load(Qa(e)+".loader").nextLoad(e)}function T(e,b){if(e===s)return U;if(b===s){if(1===
arguments.length)return U[e];delete U[e]}else return U[e]=b}function Pa(e){var b=h.Deferred();e.nextLoad=function(a){var c=y.call(arguments);e.then(function(){k.load.apply(null,c).then(function(){b.resolve.apply(b,y.call(arguments))},function(){b.reject(a)})},function(){b.reject(a)});return Pa(b.promise())};e.andLoad=function(){var a=k.apply(null,arguments);return Pa(h.when(a,e))};return e}function S(e){return e.replace(Jc,"").split(Kc)}function Ub(e){e=Vb.exec(e.toLowerCase());return!(!e||!(e[1]!=
Ra[1]||e[2]!=Ra[2]||(e[3]||("http:"===e[1]?80:443))!=(Ra[3]||("http:"===Ra[1]?80:443))))}function Sa(e){gb.href=Lc.test(e)?e:hb+e;Ub(e)?e=gb.href:(e=gb.href,e=Aa(e),e=sa?e+(Mc.test(e)?"&":"?")+Ba+"="+sa:e);return e}function Aa(e){return""===sa?e:e.replace(Wb,"")}function Xb(e,b){var a=h.extend(!0,{},U);k.unload(e,!0);b&&b();return k.load(e).done(function(){for(var b in a)U[b]&&a[b]&&(U[b].refCount=a[b].refCount,U[b].url=a[b].url,U[b].assetId=a[b].assetId)})}function Nc(e,b){if(e&&!b||b&&!e)return!0;
if(!e&&!b)return!1;e=S(e).sort();b=S(b).sort();if(e.length!=b.length)return!0;for(var a=0;a<e.length;a++)if(e[a]!=b[a])return!0;return!1}function ra(e){var b,a;for(a=ib.length-1;0<=a&&!(b=ib[a](e));a--);b=b||k.defaultLoader;return Ca[b]}function ta(e,b,a){return p({},jb,t(e)?e:{get:e,set:b,finalize:a})}function Yb(e){this.modelPath=e.publisher.path;this.e=e}function Zb(e){e=e||I.defaultEngine;if(!e)throw"engine name is not specified or default engine name is null";e=Ta[e];if(!e)throw"engine '"+e+
"' can not be found.";return e}function $b(e,b,a,c,d){a:{var f,g;if(c)for(f=ua.length-1;0<=f;f--){if(g=ua[f],g.name==c){c=g;break a}}else for(f=ua.length-1;0<=f;f--)if(g=ua[f],g.match&&g.match(b)){c=g;break a}c=void 0}if(!c||!c[d])throw"can not find "+d+" method for view";a[d+"ViewValue"]=c[d];c.convert&&(a.convert=c.convert);b.hmData("valueBound")||(c.initialize&&c.initialize(b,e.get()),b.parents("form").bind("reset",function(){V(function(){b.triggerHandler("resetVal")},10)}),b.hmData("valueBound",
!0))}function Oc(e){var b=this.path;e=e.originalPublisher.path;var a=e.substr(b.length+1),c=a.indexOf("."),b=b+"."+a.substr(0,c)+".__state";e!==b&&j.get(b)==B.unchanged&&j.set(b,B.modified)}function Ua(e,b){var a=e.get();return a.constructor[b](a).done(function(){e.set("__state","destroy"==b?B.detached:B.unchanged);e.trigger("afterSync."+b)})}function ac(e){if(""===e)return!Da.length;for(var b=e+".",a=0,c,d=Da.length;a<d;a++)if(c=Da[a],c==e||c.startsWith(b))return!1;return!0}function bc(e,b){return b?
function(a){return!e.test(a)}:function(a){return e.test(a)}}function Y(e,b){return b.error||e.supplant(b)}function cc(e){var b=j(e+"*errors");b.isEmpty()||(b.clear(),Va.removeItem(e))}function Pc(e){return{initialize:e.initialize,get:function(b){var a,c,d=b.publisher;a=b.handler.options;var f=b.proposed;b=e.name&&n.errors[e.name];if(e.buildError)b=e.buildError(b,a);else{var g=t(a)?a.error:a;b=b&&b.contains("{0}")?b.format.apply(b,g.split(",")):g||b||e.error}if(null===f||f===s||dc.test(f)){a:{a=j(d.path).subsToMe();
for(f=0;f<a.length;f++)if(a[f].handler.get===Qc){a=!0;break a}a=!1}a?(a=!1,c=!0):a=!0}else a=e.isValid(f,a);a?d.removeError(b):!c||"required"===e.name?d.addError(b):d.removeError(b)}}}function ec(e,b){for(var a=j.subscription.getAll(),c={},d=a.length-1,f,g;0<=d;d--)f=a[d],g=f.publisher,m(g)&&(!c[g]&&g.startsWith(e)&&f.eventTypes.contains("checkValidity"))&&(c[g]=!0,b(g))}function Rc(e){var b;b=e.publisher;if(1===e.level){b=b.get().table;for(var a in b)if(b[a]==e.removed){this.set(a,e.proposed);break}}else if(2<=
e.level){a=e.originalPublisher.path.substr(b.path.length+1);var c=a.substr(0,a.indexOf("."));h.isNumeric(c)&&(a="table."+b.keyAt(c)+a.substr(a.indexOf(".")),b.trigger(a,"afterUpdate",e.proposed,e.removed))}}function Sc(e){this.set(e.publisher.get().guid++,e.proposed)}function Tc(e){var b=this.get();e=e.removed;for(var a in b)if(b[a]===e){this.del(a);break}}function Uc(e){this.removeItem(e.removed)}function Vc(e){this.replaceItem(e.removed,e.proposed)}function kb(e){this.selectedIndex=e}function Wa(e,
b){var a={},c={"true":!0,"false":!0,"null":null};h.each(e.replace(Wc," ").split("&"),function(d,e){var g=e.split("="),h=decodeURIComponent(g[0]),j=a,l=0,k=h.split("]["),m=k.length-1;Xc.test(k[0])&&Yc.test(k[m])?(k[m]=k[m].replace(Zc,""),k=k.shift().split("[").concat(k),m=k.length-1):m=0;if(2===g.length)if(g=decodeURIComponent(g[1]),b&&(g=g&&!isNaN(g)?+g:"undefined"===g?s:c[g]!==s?c[g]:g),m)for(;l<=m;l++)h=""===k[l]?j.length:k[l],j=j[h]=l<m?j[h]||(k[l+1]&&isNaN(k[l+1])?{}:[]):g;else x(a[h])?a[h].push(g):
a[h]=a[h]!==s?[a[h],g]:g;else h&&(a[h]=b?s:"")});return a}function fc(){lb=lb||new A("^#"+n.hashPrefix+n.routePrefix);return ca.hash.replace(lb,"")}function Ea(){var e=fc();return(e=$c.exec(e))&&e[1]||""}function Fa(){var e=fc();return(e=ad.exec(e))&&e[1]||""}function bd(e){var b=O(e.publisher.path);e={};e[b]=q.get(b);b=Fa();b=Wa(b);e=h.extend({},b,e);e=Ea()+"?"+h.param(e);ca.hash=n.hashPrefix+n.routePrefix+e}function cd(e){var b,a,c;c=e.publisher.path;e=e.handler.options;b=Ea();if(gc(b,e)){a=b.split("/");
for(var d=0;d<a.length;d++)if(b=e[d],b.startsWith(":")&&b.substr(1)==c){a[d]=q.get(c);c=a.join("/");e=Fa();ca.hash=n.hashPrefix+n.routePrefix+(e?c+"?"+e:c);break}}}function gc(e,b){var a,c;if(e&&(c=e.split("/"),c.length===b.length)){for(var d=!0,f=0;f<c.length;f++)if(a=b[f],!a.startsWith(":")&&a!=c[f]){d=!1;break}return d}}function hc(e,b,a){var c,d=gc(e,b);e=e.split("/");for(var f=0;f<b.length;f++)c=b[f],c.startsWith(":")&&(c=c.substr(1),d&&q.set(c,e[f]),a&&j.sub(null,c,"afterUpdate",cd,b));return d}
function ic(e,b){var a=h.isEmptyObject(b);if(e||!a){var c=ca.href.replace(ca.hash,""),a=n.hashPrefix+n.routePrefix+e+(a?"":"?"+h.param(b)),c=c+"#"+a;jc.replaceState?jc.replaceState(null,null,c):ca.href=c}}function kc(e){this.set(e.publisher.attr(e.handler.options));e.preventDefault();e.stopPropagation()}var j=C.hm=function(e,b){return new mb(e,b)},mb=function(e,b){this.path=L(e||"",!0);l(b)||this.set(b)},da=C.document,nb=C.localStorage,V=C.setTimeout,jc=C.history,ca=C.location,dd=C.alert,ed=C.confirm,
M,p=h.extend,ob={},x=h.isArray,r=h.isFunction,fd={undefined:s,"boolean":s,number:s,string:s},K="__hm",Cb=/^__hm\.([^\.]+?)(?:\.|$)/,gd=/this\.(?:get)\s*\(\s*(['"])([\*\.\w\/]+)\1\s*\)/g,X={},n={},q,W=ob[K]={},hd=ob.hasOwnProperty,Za=C.Array,lc=Za.prototype,id=String.prototype,y=lc.slice,w,jd=/^(?:\{.*\}|\[.*\])$/,kd=/^\.(\.*)([\.\*])/,ld=/^\.<(.*)/,mc=/^[\.\*]/,md=/[\.\*]/,nd=/#+|\./g,$a=/#+/g,A=C.RegExp,Bc=/^(.+)[\.\*]\w+$/,G,od=/^.+\.(\w+)$|\w+/,P,l,Q,m,t,ea,pb=h.isNumeric,$,Ga,L,O,qb,pa=h.fn,va,
pd=/\{([^\{\}]*)\}/g;Ab(lc,{indexOf:function(e,b){for(var a=b||0;a<this.length;a++)if(this[a]==e)return a;return-1},contains:function(e){return-1!==this.indexOf(e)},remove:function(e){e=this.indexOf(e);-1!=e&&this.splice(e,1);return this},removeAt:function(e){this.splice(e,1);return this},pushUnique:function(e){this.contains(e)||this.push(e);return this},merge:function(e){if(e&&e.length)for(var b=0;b<e.length;b++)this.pushUnique(e[b]);return this},sortObject:function(e,b){l(b)&&(l(e)?(b=!0,e=s):m(e)?
b=!0:(b=e,e=s));e?this.sort(function(a,c){var d=a[e],f=c[e];return d==f?0:b?d>f?1:-1:d>f?-1:1}):b?this.sort():this.sort().reverse();return this}});Ab(id,{startsWith:function(e){return 0===this.indexOf(e)},contains:function(e){return-1!==this.indexOf(e)},endsWith:function(e){return-1!==this.indexOf(e,this.length-e.length)},supplant:function(e){return this.replace(pd,function(b,a){var c=e[a];return typeof c?c:b})},format:function(){var e=this;h.each(arguments,function(b,a){e=e.replace(new A("\\{"+b+
"\\}","g"),a)});return e}});M=mb.prototype=j.fn=j.prototype={constructor:mb,toString:function(){return this.path},get:function(e){var b;if(b=this.accessor(e,!0)){if(r(b.hostObj))return b.hostObj.apply(this.cd(".."),y.call(arguments));b=!b.index?b.hostObj:b.hostObj[b.index];return r(b)?b.apply(this.cd(e).cd(".."),y.call(arguments,1)):b}},getJson:function(){return JSON.stringify(this.get.apply(this,y.call(arguments)))},raw:function(e,b){var a;r(e)&&(b=e,e="");if(b)return a=this.accessor(e),a.index in
a.hostObj?this.update(e,b,a):this.create(e,b,a);if(a=this.accessor(e,!0))return!a.index?a.hostObj:a.hostObj[a.index]},set:function(e,b,a){if(1==arguments.length){if(""===this.path)throw"root object can not changed";q.set(this.path,e,b);return this}var c=y.call(arguments);if(ea(e)){if(2==arguments.length)return q.set(e,this.path,b),this}else a=b,b=e,e=!1;var d=this.accessor(b),f=d.hostObj[d.index];return r(f)?(f.apply(this.cd(b).cd(".."),y.call(c,1)),this):d.index in d.hostObj?this.update(e,b,a,d):
this.create(e,b,a,d)},accessor:function(e,b){0===e&&(e="0");var a,c,d=ob,f=this.getPath(e),g=L(f,!0),h=g.split(".");if(1===h.length)c=g;else{c=h[h.length-1];for(a=0;a<h.length-1&&!(d=d[h[a]],d===s);a++);}if(Q(d)){if(b)return;throw"invalid update on unreachable node '"+O(f)+"'";}return{physicalPath:g,hostObj:d,index:c}},create:function(e,b,a,c){ea(e)||(c=a,a=b,b=e,e=!1);c=c||this.accessor(b);b=c.physicalPath;var d=c.hostObj,f=c.index,g=x(d);if(g&&pb(f)){if(f>d.length)throw"you can not add item with hole in array";
}else if(f in d)throw"value at path: '"+O(c.physicalPath)+"' has been defined, try use update method instead";if(!e&&w(b,b,"beforeCreate",a).hasError())return!1;g&&pb(f)?f==d.length?d[f]=a:f<d.length&&d.splice(c.index,0,a):d[c.index]=a;bb(b,a);w(b,b,"afterCreate",a);return this},extend:function(e,b){var a;b?a=this.cd(e):(b=e,a=this);for(var c in b)a.set(c,b[c]);return this},update:function(e,b,a,c){if(1==arguments.length){if(""===this.path)throw"root object can not updated";q.update(this.path,e);
return this}if(ea(e)){if(2==arguments.length)return q.update(e,this.path,b),this}else c=a,a=b,b=e,e=!1;c=c||this.accessor(b);if(!(c.index in c.hostObj))throw"value at path: '"+O(c.physicalPath)+"' has been not defined, try use create method instead";var d=c.physicalPath,f=c.hostObj[c.index];if(f==a)return this;if(!e&&w(d,d,"beforeUpdate",a,f).hasError())return!1;c.hostObj[c.index]=a;bb(d,a);e||w(d,d,"afterUpdate",a,f);return this},del:function(e){if(l(e)){if(this.path)return q.del(this.path);throw"root can not be deleted";
}var b=this.accessor(e),a=b.hostObj;e=b.physicalPath;var c=a[b.index],d=x(a);if(w(e,e,"beforeDel",s,c).hasError())return!1;w(e,e,"duringDel",s,c);d?a.splice(b.index,1):delete a[b.index];for(b=0;b<Xa.length;b++)Xa[b](e,c);w(e,e,"afterDel",s,c);return c},createIfUndefined:function(e,b){if(l(b))throw"missing value argument";var a=this.accessor(e);return a.index in a.hostObj?this:this.create(e,b,a)},toggle:function(e){var b=this.accessor(e);b.index in b.hostObj&&this.update(e,!b.hostObj[b.index],b);return this},
pushStack:function(e){e.previous=this;return e},cd:function(e){return this.pushStack(j(this.getPath(e)))},parent:function(){return this.cd("..")},shadow:function(){return this.cd("*")},sibling:function(e){return this.cd(".."+e)},main:function(){return this.pushStack(j(Bb(this.path)))},getPath:function(e){return G(this.path,e)},logicalPath:function(e){return O(this.getPath(e))},physicalPath:function(e){return L(this.getPath(e))},pathContext:function(){return Fb(this.path)},pathIndex:function(){var e=
od.exec(this.path);return e[1]||e[0]},invokeUnwrapped:function(e){if(0===arguments.length)throw"methodName is missing";var b=this.get();return b[e].apply(b,y.call(arguments,1))},indexOf:function(e){return this.get().indexOf(e)},contains:function(e){return-1!==this.indexOf(e)},first:function(e){return e?this.filter(e)[0]:this.get("0")},last:function(){var e=this.get();return e[e.length-1]},push:function(e){for(var b=0;b<arguments.length;b++)this.create(this.get().length,arguments[b]);return this},
pushUnique:function(e){return!this.contains(e)?this.push(e):this},pop:function(){return this.removeAt(this.get().length-1)},shift:function(){return this.del(0)},unshift:function(e){return this.create(0,e)},insertAt:function(e,b){return this.create(e,b)},updateAt:function(e,b){return this.update(e,b)},removeAt:function(e){return this.del(e)},move:function(e,b){var a=this.count();e!==b&&(0<=e&&e<a&&0<=b&&b<a)&&(a=this.del(e),this.insertAt(b,a),w(this.path,this.path,"move",b,e));return this},replaceItem:function(e,
b){if(e==b)return this;var a=this.indexOf(e);return-1!=a?this.updateAt(a,b):this},removeItem:function(e){e=this.indexOf(e);return-1!==e?this.removeAt(e):this},removeItems:function(e){for(var b=0;b<e.length;b++)this.removeItem(e[b]);return this},clear:function(){var e=this.get(),b=e.splice(0,e.length);w(this.path,this.path,"afterCreate",e,b);return this},count:function(){return this.get().length},filter:function(e){return h(this.get()).filter(e).get()},each:function(e,b){ea(e)||(b=e,e=!1);var a,c,
d,f;if(e){f=this.get();for(c=f.length-1;0<=c;c--)if(d=b.call(f[c],c,f[c],f),!0===d)a=!0;else if(!1===d)break;a&&this.change()}else for(c=this.count()-1;0<=c&&!(a=this.cd(c),!1===b.call(a,c,a,this));c--);return this},map:function(e){return h.map(this.get(),e)},sort:function(e,b){return w(this.path,this.path,"afterUpdate",this.get().sortObject(e,b))},watch:function(){for(var e=0;e<arguments.length;e++)Db(this.path,arguments[e]);return this},unwatch:function(){for(var e=0;e<arguments.length;e++)Eb(this.path,
arguments[e]);return this},isEmpty:function(e){e=this.get(e);return!e?!0:!x(e)?!1:0===e.length},isShadow:function(){return this.path.startsWith(K)},toJSON:function(e){return JSON.stringify(this.get(e))},compare:function(e){if(e)if(e=Ga(e),m(e)){if(this.get()==e)return!0;try{return eval("this.get()"+e)}catch(b){return!1}}else return this.get()==e;else return this.isEmpty()},saveLocal:function(e){P.local(this.getPath(e),this.get(e));return this},getLocal:function(e){return P.local(this.getPath(e))},
restoreLocal:function(e){q.set(this.getPath(e),this.getLocal(e));return this},clearLocal:function(e){P.local(this.getPath(e),s);return this}};var ia=[function(e,b,a){if(r(a)&&(!a.name||!a.name.startsWith("_"))){b=e?e+"."+b:b;var c=a.toString(),d;for(a=[];d=gd.exec(c);)a.pushUnique(d[2]);for(c=0;c<a.length;c++)Db(b,e?G(e,a[c]):a[c])}}],na={},rb=function b(a){var c;if(!(this instanceof b))return c=new b(na),b.apply(c,arguments);if(arguments[0]===na)return this;this.initialize.apply(this,arguments);
return this},wa;p(rb.prototype,{callProto:function(b){return this.constructor.prototype[b].apply(this,y.call(arguments,1))},callBase:function(b){wa=wa||this;if(wa=wa.constructor.__super__){var a=wa[b].apply(this,y.call(arguments,1));wa=null;return a}},initialize:function(b){p(this,b)},toJSON:function(){var b=p(!0,{},this),a;for(a in b)a.startsWith("__")&&delete b[a];return b}});p(rb,{list:function(b){var a,c,d=[],f;if(!l(b)){x(b)||(b=y.call(arguments));f=b.itemIsObject;for(a=0;a<b.length;a++)c=b[a],
d.push(f||!x(c)?b instanceof this?this:new this(c):this.apply(null,c))}return d},extend:function(b,a){var c,d=this;c=b&&b.hasOwnProperty("constructor")?b.constructor:function v(){var a;if(!(this instanceof v))return a=new v(na),v.apply(a,arguments);if(arguments[0]===na)return this;d.apply(this,arguments);return this};p(c,d,a);var f=function(){this.constructor=c};f.prototype=d.prototype;c.prototype=new f;b&&p(c.prototype,b);c.__super__=d.prototype;return c}});p(j,{Class:rb,util:P={toPhysicalPath:L=
function(b,a){for(var c,d="",f="",g;c=md.exec(b);)b=A.rightContext,f=A.leftContext,"."==c[0]?d?(d==K&&(a&&!W[f])&&(g=f.replace($a,ab),l(q.get(g))||(W[f]={})),d=d+"."+f):d=f:(d?(c=(d?d.replace(nd,Ac):d)+"#"+f,g=d+"."+f):g=f?c=f:c="",d=K+(c?"."+c:""),a&&(!W[c]&&d!=K&&!l(q.get(g)))&&(W[c]={}));return!b?d:d?d+"."+b:b},toLogicalPath:O=function(b){var a;return b===K?"*":(a=Cb.exec(b))?(b=A.rightContext,a=a[1].replace($a,ab),O(a+"*"+b)):b},mergePath:G=function(b,a,c){if("_"==a)return"_";if("_"==b)if(a&&
a.startsWith("/"))b="";else return"_";b=L(b);if(!l(a)&&null!==a&&(a+="",a.startsWith("/")))return a.substr(1);l(c)&&(c=!0);c&&(a&&b&&!mc.test(a))&&(a="."+a);if(!a||"."==a)return b;if(mc.test(a)){if(c=kd.exec(a)){a=1+(c[1]?c[1].length:0);for(var d=A.rightContext;a;)b=Fb(b),a--;return d?b?b+c[2]+d:d:"*"===c[2]?b+"*":b}if(c=ld.exec(a))return G(Bb(b),c[1])}else return a;return b+a},isUndefined:l=function(b){return b===s},isPrimitive:Q=function(b){return null===b||typeof b in fd},isString:m=function(b){return"string"===
typeof b},isObject:t=function(b){return"object"===h.type(b)},isBoolean:ea=function(b){return"boolean"===typeof b},toTypedValue:Ga=function(b){if(m(b)){b=h.trim(b);try{b="true"===b?!0:"false"===b?!1:"null"===b?null:"undefined"===b?s:pb(b)?parseFloat(b):jd.test(b)?h.parseJSON(b):b}catch(a){}}return b},isPromise:$=function(b){return!(!b||!b.promise||!b.done||!b.fail)},clearObj:qb=function(b){if(Q(b))return null;for(var a in b)hd.call(b,a)&&(b[a]=qb(b[a]));return b},clone:va=function(b,a){return Q(b)?
b:x(b)?b.slice(0):r(b)?b:p(!!a,{},b)},local:function(b,a){if(1==arguments.length)return JSON.parse(nb.getItem(b));l(a)?nb.removeItem(b):nb.setItem(b,JSON.stringify(a))},toString:function(b){return null===b||b===s?"":""+b},encodeHtml:function(b){var a=da.createElement("div");a.appendChild(da.createTextNode(b));return a.innerHTML}},onAddOrUpdateNode:function(b){return b?(ia.push(b),this):ia},onDeleteNode:function(b){return b?(Xa.push(b),this):Xa},options:n});var Xa=[function(b){var a,c,d=O(b);for(a in X)Eb(b,
a);for(a in X)a.startsWith(b)&&delete X[a];for(c in W)b=K+"."+c,a=O(b),(a==d||a.startsWith(d+"*")||a.startsWith(d+"."))&&q.del(b)}];h(["get","set","del","extend"]).each(function(b,a){j[a]=function(){return q[a].apply(q,y.call(arguments))}});q=j();pa.hmData=function(b,a){var c=this.data("hmData");if(0===arguments.length)return c;if(1===arguments.length)return c&&c[b];l(c)&&this.data("hmData",c={});c[b]=a};var aa,la=/[ ]+/,Kb=/\*\.$/,Dc=/\.|\*/g,H,qd=0,rd=/init(\d*)/,Na=["get","set","convert","finalize",
"initialize"];Ka.prototype={constructor:Ka,isDependent:function(){return!this.publisher.path.startsWith(this.originalPublisher.path)},stopPropagation:function(){this.isPropagationStopped=D},stopImmediatePropagation:function(){this.isCascadeStopped=this.isPropagationStopped=this.isImmediatePropagationStopped=D},stopCascade:function(){this.isCascadeStopped=D},error:function(){this.hasError=D},abort:Lb,isCascadeStopped:ja,isPropagationStopped:ja,isImmediatePropagationStopped:ja,isAborted:ja,hasError:ja,
level:0};w=function(b,a,c,d,f){d=new Ka(b,a,c,d,f);Jb(d);if(!d.isPropagationStopped()&&d.publisher.path){d.isDependent()&&(d.originalPublisher.path=d.publisher.path);do d.publisher.path=d.publisher.pathContext(),d.level++,d.type=d.originalType+"."+d.level,Jb(d);while(!d.isPropagationStopped()&&d.publisher.path)}d.type=c;d.originalPublisher.path=a;d.publisher.path=b;return d};var sb=function(b,a){m(b)&&(b=L(b));for(var c=[],d=0,f;d<fa.length;d++)f=fa[d],a(f,b)&&c.push(f);return c},fa=[];H={getByPublisher:function(b){return sb(b,
function(a,b){return a.publisher==b})},getBySubscriber:function(b){return sb(b,function(a,b){return a.subscriber==b})},getBy:function(b){return sb(b,function(a,b){return a.subscriber==b||a.publisher==b})},getAll:function(){return fa},add:function(b,a,c,d){if(m(a))for(var f=c.split(la),g=0;g<f.length;g++){var h=this.special[f[g]];h&&h.setup&&h.setup(b,a)}fa.push({publisher:a,subscriber:b,eventTypes:c,handler:d})},removeBy:function(b){var a,c,d,f=[];for(a=fa.length-1;0<=a;a--)if(d=fa[a],c=d.handler,
b===d.publisher||b===d.subscriber||m(b)&&(m(d.publisher)&&d.publisher.startsWith(b+".")||m(d.subscriber)&&d.subscriber.startsWith(b+".")))m(d.publisher)||(c.delegateSelector?h(d.publisher).undelegate(c.delegateSelector,d.eventTypes,oa):h(d.publisher).unbind(d.eventTypes,oa)),f.push(fa.splice(a,1)[0]);for(a=f.length-1;0<=a;a--)if(d=f[a],m(d.publisher)){var g=d.eventTypes.split(la);for(b=0;b<g.length;b++)(c=this.special[g[b]])&&c.teardown&&c.teardown(d.subscriber,d.publisher)}},special:{}};p(j,{trigger:w,
subscription:H,sub:function(b,a,c,d,f,g){b instanceof j&&(b=b.path);a instanceof j&&(a=a.path);m(b)&&b.startsWith("$")&&(b=h(b.substr(1)));if(b&&b.jquery)if(!b.length&&!b.selector)b=null;else{b.each(function(b,h){j.sub(h,a,c,d,f,g)});return}m(a)&&a.startsWith("$")&&(a=h(a.substr(1)));if(a&&a.jquery)a.each(function(a,h){j.sub(b,h,c,d,f,g)});else{if(!a&&""!==a)throw"publisher can not be null";if(!c)throw"eventTypes can not be null";if("_"===b||"null"==b||null===b)b=s;"_"===f&&(f=s);var v=m(a),u=m(b);
ka.mark(a);ka.mark(b);v&&(a=L(a));u&&(b=L(b));if(v){var l=a,k=c,n=b,q=d,v=f,p,r,E;E=k.split(" ");for(var J=0;J<E.length;J++)if(u=rd.exec(E[J])){r=E[J];p=+u[1];E.splice(J,1);k=E.join(" ");break}q=Mb(q,l,n,v);k&&H.add(n,l,k,q);r&&(k=function(){var a=new Ka(l,l,r);La(R(n),q,a)},p?V(k,p):k())}else{p=a;v=c;u=b;E=d;var J=f,tb;tb=v.split(" ");tb.contains("init")&&(k=!0,v=tb.remove("init").join(" "));E=Mb(E,p,u,J);J={handler:E,subscriber:u};v?(v=Ib(v,p,u),g?(E.delegateSelector=g,h(p).delegate(g,v,J,oa)):
h(p).bind(v,J,oa),H.add(u,p,v,E),k&&(g?h(p).find(g).trigger(v):h(p).trigger(v))):k&&(h(p).one("init",J,oa),h(p).trigger("init"))}}},handle:function(){return this.sub.apply(this,[null].concat(y.call(arguments)))},workflow:function(b,a){if(t(b))for(var c in b)aa[c]=Nb(b[c]);else{if(l(b))return aa;if(l(a))return aa[b];aa[b]=Nb(a);return aa[b]}},activity:{initialize:{},get:{getMember:Gb,getOriginal:function(b){return b.originalPublisher.get()},fakeGet:function(){return na}},set:{setMember:Hb,fakeSet:h.noop},
convert:{toString:P.toString,toTypedValue:P.toTypedValue,toNumber:function(b){return+b},toDate:function(b){return new Date(b)}},finalize:{}}});aa={change:{get:function(b){q.change(b.handler.options)}},saveLocal:{get:function(b){var a=b.publisher.path;V(function(){j(a).saveLocal()},1)}}};var ka={getId:function(b){return h(b).hmData("viewId")},unMark:function(b){h(b).hmData("viewId",s)},mark:function(b){t(b)&&!h(b).hmData("viewId")&&h(b).hmData("viewId",++qd)}};j.onDeleteNode(Ob);p(M,{trigger:function(b,
a,c,d){if(!arguments.length)throw"missing arguments";3>=arguments.length&&(d=c,c=a,a=b,b="");var f=this.physicalPath(b);w(f,f,a,c,d);return this},change:function(b){var a=this.physicalPath(b);b=this.get(b);w(a,a,"afterUpdate",b,b);return this},sub:function(b,a,c,d,f){j.sub(this.path,b,a,c,d,f);return this},handle:function(b,a,c,d){j.sub(null,this,b,a,c,d);return this},subBy:function(b,a,c,d,f){j.sub(b,this.path,a,c,d,f);return this},subsToMe:function(){return H.getByPublisher(this.path)},subsFromMe:function(){return H.getBySubscriber(this.path)},
subs:function(){return H.getBy(this.path)},mapEvent:function(b,a,c){c=c||D;j.handle(this.path,b,function(b){c.call(this,b)&&b.publisher.trigger(a,b.proposed,b.removed)});return this},cacheable:function(b){j.handle(this.getPath(b),"init after*","*saveLocal");return this}});p(pa,{sub:function(b,a,c,d,f){this.length&&j.sub(this,b,a,c,d,f);return this},handle:function(b,a,c,d){this.length&&j.sub(null,this,b,a,c,d);return this},subBy:function(b,a,c,d,f){this.length&&j.sub(b,this,a,c,d,f);return this},
subsToMe:function(){return H.getByPublisher(this[0])},subsFromMe:function(){return H.getBySubscriber(this[0])},subs:function(){return H.getBy(this[0])},renderView:function(b,a,c){j.sub(this,b,"init",a,c);return this},mapEvent:function(b,a,c,d){c?r(c)||(d=c,c=D):c=D;return this.handle(b,function(b){c.call(this,b)&&(b.type=a,b.eventData=d,b.publisher.trigger(b))})}});j.newJqEvent=function(b,a,c){if(t(b)){for(var d in b)j.newJqEvent(d,b[d][0],b[d][1]);return this}var f=function(a){(!0===c||c.call(this,
a))&&h(a.target).trigger(p({},a,{type:b,currentTarget:a.target}))};if(h.event.special[b])throw"event '"+b+"' has been defined";h.event.special[b]={setup:function(){h(this).bind(a,f)},teardown:function(){h(this).unbind(a,f)}};return this};var sd=h.cleanData;h.cleanData=function(b){h(b).each(function(){Ob(this)});sd(b)};P.getUniqueViewEventTypes=Ib;P._viewHandlerGateway=oa;var Ic=/([!$]?)([\w \+\-\*\.]+?):([\w\W]+?)\s*(?:[;]\s*|$)/g,td=/^([^|]+)(\|(.*))?$/,ud=/\s*\|\s*/g;n.subsAttr="data-sub";n.autoParse=
!0;var Fc=/_/g,Gc=/-(\w)/g,Ec=/^data-/,Hc=function(b,a){return a.toUpperCase()};ba.prototype={_importBindings:function(){var b,a,c,d,f,g=this.bindings;for(b=0;b<g.length;b++)d=g[b],a=d.bindingName,c=td.exec(d.value),d=c[1],f=c[3],c=qa[a],r(c)?(d=[c,this.elem,G(this.ns,d),this,db(this.options,f)],"runFirst"==a?this.context.runFirst=d:"runLast"==a?this.context.runLast=d:this.context.dynamicBindings.push(d)):m(c)&&new ba(c,this,d,f)},_importSubscriptions:function(b){var a,c,d,f,g,h=this[b];for(a=0;a<
h.length;a++)c=h[a],f=c.eventTypes,c=c.value.split(ud),"sub"==b?(d=c[0],d=d.startsWith("$")?d:G(this.ns,d),g=this.elem):(d=this.elem,g=c[0],g=g.startsWith("$")?g:G(this.ns,g)),this.appendSub(g,d,f,c[1],Ga(db(this.options,c[2])),c[3])},appendSub:function(b,a,c,d,f,g){this.context.subscriptions.push({publisher:a,eventTypes:c,subscriber:b,handler:d,options:f,delegate:g})},prependSub:function(b,a,c,d,f,g){this.context.subscriptions.unshift({publisher:a,eventTypes:c,subscriber:b,handler:d,options:f,delegate:g})},
clearSubs:function(){this.context.subscriptions.splice(0,this.subscriptions.length)}};V(function(){h(function(){n.autoParse&&eb(da.documentElement)})},1);pa.parseSubs=function(){return this.each(function(){eb(this)})};var nc=j("*log",[]),qa={};p(j,{binding:z,log:function(b,a){b+="";nc.push(a?"<div style='color:"+a+"'>"+b+"</div> ":b)},clearlog:function(){nc.clear()}});z("runFirst",Qb);z("runLast",Qb);var Ha={},U={},Ia={},oc={},Ca={},gb=da.createElement("a"),Kc=/,/,Jc=/\s+/g,Mc=/\?/,vd=/\.(\w+)$/,
wd=/(.+)\.\w+$/,Qa,pc,qc,Z,N,Lc=/^http[s]?:\/\/|^\//,Vb=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,Ra=Vb.exec(ca.href.toLowerCase())||[],sa="",Ba="v",Wb,ub=[],vb=[],wb=[],ib,rc={},hb="",k=j.loader=function(b,a,c){if(l(a))return b?Ca[b]:Ca;m(a)||(c=a,a=null);c=oc[b]=h.extend(!0,{},oc[a],c);var d=h.extend(!0,{},c);h.each(["load","unload","url","depend"],function(a,b){var c=d[b];m(c)&&(c=qc[b][c])&&(d[b]=c)});if(h.isPlainObject(d.load)){var f=d.load,g;for(g in f){c=f;var j=g;m(c[j])&&(c[j]=Z[j][c[j]])}var u=
f.staticLoaded||Z.staticLoaded.returnFalse,p=f.getSource||Z.getSource.getTextByAjax,n=f.compile===s?Z.compile.globalEval:f.compile,q=f.crossSiteLoad||Z.crossSiteLoad.getScript,r=f.buildDependencies||Z.buildDependencies.parseDependTag,t=f.buildUnload||Z.buildUnload.parseUnloadTag;if(!n&&!q)throw"loader must implement at least one of compile, crossSiteLoad";d.load=function(a){var b=h.Deferred(),c=b.promise(),d;if(u(a))c.refCount="staticLoaded",b.resolve();else{d=k.url(a);if(!n||f.byPassGetSource||Ub(d)){if(!q)throw"loader does not support cross domain loading";
return q(a)}p(a).then(function(d){if(t){var f=t(d,a);f&&(T(a).unload=f)}r&&(f=r(a,d))&&N(a,f);var f=function(){var f=n&&n(a,d);V(function(){b.dontResolve||(b.resolve(f),delete c.defer)},5)},g=N(a);g?k.load(g).then(f,function(){b.reject(a);delete c.defer}):f()},function(){b.reject(a);delete c.defer});xb(b)||(c.defer=b)}return c}}if(!h.isFunction(d.load))throw"missing load function from loader";Ca[b]=h.extend({},Ca[a],d)},xd=fb(vb),yd=fb(ub),zd=fb(wb),xb=h.Deferred().isResolved?function(b){return b.isResolved()}:
function(b){return"resolved"==b.state()};h.extend(k,{load:function(b,a,c){ea(b)||(c=a,a=b,b=!1);if(a)return b=b&&!h.isReady,a=Rb(a,c),b&&(h.holdReady(!0),a.done(function(){h.holdReady()})),a.done(yd).fail(xd)},unload:function(b,a){var c,d;if(h.isFunction(b))a?wb.remove(b):wb.push(b);else if(m(b)&&(b=S(b)),1!=b.length)for(c=0;c<b.length;c++)k.unload(b[c]);else if(c=b[0],(d=T(c))&&"staticLoaded"!=d.refCount){if(0===--d.refCount||a)if((d=d.unload||ra(c).unload)&&d(c),T(c,s),d=N(c))k.unload(d,a),N(c,
s);zd()}},url:function(b,a){if(t(b))for(var c in b)k.url(c,b[c]);else if(a===s){if(1==arguments.length){if(Ha[b])return Ha[b];c=ra(b);return Sa(c&&c.url?c.url(b):c&&c.fileExt?pc(b)+"."+c.fileExt:b)}delete Ha[b]}else{c=k.url(b);var d=Sa(a);c!=d&&((c=T(b))&&xb(c)?Xb(b,function(){Ha[b]=d}):Ha[b]=d)}},depend:N=function(b,a){if(t(b))for(var c in b)N(c,b[c]);else if(a===s){if(1==arguments.length){c=Ia[b];var d=ra(b);return d&&d.depend?(d=d.depend(b))&&c?d+","+c:d?d:c:c}delete Ia[b]}else if(!0===a){if(c=
(c=N(b))&&S(c)){for(var d=[],f=0;f<c.length;f++)"module"!==k.fileExt(c[f])&&d.pushUnique(k.url(c[f])),d.merge(N(c[f],!0));return d}}else{var g;c=a;if(f=(d=ra(b))&&d.depend&&d.depend(b)){d=[];f=S(f);c=S(c);for(var h=0;h<c.length;h++)f.contains(c[h])||d.push(c[h]);g=d.length?d.join():null}else g=c;c=Ia[b];Nc(g,c)&&(d=T(b),c&&d&&xb(d)?Xb(b,function(){Ia[b]=g}):Ia[b]=g)}},baseUrl:function(b){if(l(b))return hb;hb=b.endsWith("/")?b:b+"/"},hash:function(b,a){arguments.length&&(sa=!0===b?h.now():b,Ba=a!==
s?a:Ba||"v",Wb=new A("[?&]"+Ba+"=[^&]*"));return""===sa?"":Ba+"="+sa},methods:qc={load:{cacheImage:function(b){var a=h.Deferred(),c=a.promise(),d=k.url(b);b=new Image;b=new Image;b.onload=function(){a.resolve(d)};b.onerror=function(){a.reject(d)};b.src=d;return c}},unload:{removeCssLinkTag:function(b){var a=Sa(k.url(b));h("link").filter(function(){return this.href===a&&h(this).attr("loadedByloader")}).remove()}},url:{assetId:function(b){return b},folder:function(b){var a=ra(b).fileExt,a=a?k.fileName(b)+
"."+a:b;return k.fileExt(b)+"/"+a}},depend:{}},loadFilters:Z={staticLoaded:{returnFalse:function(){return!1},hasScriptTag:function(b){return!!h("script").filter(function(){return Aa(this.src)===Aa(k.url(b))}).length}},getSource:{getTextByAjax:function(b){return h.ajax({url:k.url(b),dataType:"text",cache:!0})}},compile:{globalEval:function(b,a){return h.globalEval(a)},localEval:function(b,a){return eval(a)}},crossSiteLoad:{getScript:function(b){var a=h.Deferred(),c=a.promise();c.defer=a;h.getScript(k.url(b)).then(function(){V(function(){a.dontResolve||
(a.resolve(),delete c.defer)},5)},function(){a.reject();delete c.defer});return c}},buildUnload:{parseUnloadTag:function(b){return(b=Ad.exec(b))&&b[1]&&new Function(b[1])}},buildDependencies:{parseDependTag:function(b,a){var c=Bd.exec(a);return c&&c[1]||null}}},finders:ib=[function(b){return Qa(b)},function(b){b=Qa(b);if(b=rc[b])return b}],mapFileExtToLoader:function(b,a){b=S(b);for(var c=0;c<b.length;c++)rc[b[c]]=a},fileExt:Qa=function(b){return vd.exec(b)[1]},fileName:pc=function(b){return wd.exec(b)[1]},
define:function(b,a,c,d){h.isFunction(a)&&(d=c,c=a,a=null);var f,g=T(b);g?f=g.defer:(f=h.Deferred(),g=f.promise(),g.defer=f,T(b,g));g.defer.dontResolve=!0;var j=function(a){delete g.defer;g.unload=d;f&&f.resolve(c(a))};a?(N(b,a),k.load(a).done(j)):j();return g},done:function(b,a){a?ub.remove(b):ub.push(b)},fail:function(b,a){a?vb.remove(b):vb.push(b)},defaultLoader:"js"});var Ad=/<@unload>([\w\W]+?)<\/@unload>/i,Bd=/<@depend>([\w\W]+?)<\/@depend>/i,sc=h.noop;k("pack",{load:function(b){var a=h.Deferred(),
c=k.depend(b);c?k.load(c).done(function(){a.resolve(b,sc(b))}):a.resolve(b,sc(b));return a.promise()},url:"assetId"});k("js",{load:{staticLoaded:"hasScriptTag"},fileExt:"js"});k("jsl","js",{load:{compile:"localEval"}});k("loader","js",{url:"folder"});k("css",{load:{staticLoaded:function(b){return!!h("link").filter(function(){return Aa(this.href)===Aa(k.url(b))&&!h(this).attr("loadedByloader")}).length},crossSiteLoad:function(b){var a=h.Deferred();h("<link href='"+k.url(b)+"' rel='stylesheet' type='text/css' loadedByloader='1' />").load(function(){a.resolve(b)}).appendTo("head");
return a.promise()},compile:null},unload:function(b){var a=Sa(k.url(b));h("link").filter(function(){return this.href===a&&h(this).attr("loadedByloader")}).remove()},fileExt:"css"});k("image",{load:"cacheImage",noRefCount:!0});k.mapFileExtToLoader("jpg,png,bmp,gif","image");var I,Cd=/^apk\.([^.]+)(\.?)(.*)$/,Dd=/^\*/,Ta={},jb={initialize:"*templateOptions",get:"get",convert:"*template",set:"html",finalize:"*parseSubs"};j.activity.initialize.templateOptions=function(b,a,c,d){if(m(d))d=d.split(","),
c.templateId=h.trim(d[0]),c.wrapDataInArray="true"==h.trim(d[1]),c.engineName=d[2];else if(t(d)&&d.templateId)p(c,d);else if(!(c.templateId=a.hmData("embeddedTemplate")))if(b=h.trim(a.html()))b=b.replace(Ed,Fd),c.templateId="__"+h.uuid++,I.compile(c.templateId,b),a.hmData("embeddedTemplate",c.templateId),a.empty();else throw"missing template";};var Ed=/&lt;|&gt;/g,Gd={"&lt;":"<","&gt;":">"},Fd=function(b){return Gd[b]||""};Yb.prototype.get=function(){var b=this.e.publisher;return b.get.apply(b,arguments)};
j.activity.convert.template=function(b,a){if(b&&(x(b)&&b.length||!x(b))){var c,d,f=a.handler;f.templateId?(c=f.templateId,d=f.wrapDataInArray?[b]:b):(c=b,d={});if(!c)return"";var g=d;d=new Yb(a);var j=Zb(f.engineName,c);c=h.trim(c);var u=c.replace(Dd,"");if(j.isTemplateLoaded(u))c=j.render(u,g,d);else if(j.renderAsync)c=j.renderAsync(u,g,d);else{var k=h.Deferred(),f=p(!0,{},d.e),l=p(!0,{},f.publisher),n=p(!0,{},d);f.publisher=l;n.e=f;I.load(c).done(function(){var a=j.render(u,g,n),b=h(a);k.resolve(b.selector||
!b.length?a:b)});c=k.promise()}if($(c))return c;m(c)&&(c=h.trim(c));return h(h("<div />").html(c)[0].childNodes)}return""};j.activity.finalize.parseSubs=function(b){h(b).parseSubs()};j.workflow({tmpl:jb,include:ta("get","replaceWith")});z({tmpl:"!init:.|*tmpl",tmplOnChange:"!init after*.:.|*tmpl",tmplOnChildChange:"!init after*. after*.1:.|*tmpl",tmplOnAnyChange:"!init after*:.|*tmpl",include:"!init:.|*include"});pa.tmpl=function(b,a,c){a=a||"";r(c)&&(c={finalize:c});return this.renderView(a,c?p({},
jb,c):"*tmpl",b)};pa.include=function(b,a,c){r(c)&&(c={finalize:c});return this.renderView(a,c?p({},j.workflow("replace"),c):"*replace",b)};j.template=I={defaultEngine:"",engineAdapter:function(b,a){if(!b)return Ta;if(!a)return Ta[b];a.isTemplateLoaded=a.isTemplateLoaded||D;Ta[b]=a;I.defaultEngine=b},load:function(b){return k.load(b.endsWith(".html")?b:b+".template")},compile:function(b,a,c){return Zb(c).compile(b.endsWith(".template")?k.fileName(b):b,a)},newTemplateHandler:ta,templateIdToUrl:function(b){var a=
Cd.exec(b);return a?"apk/"+a[1]+"/"+(a[3]||"main")+".html":b.endsWith(".html")?b:b.split(".")[0]+".html"}};k("template",{load:{compile:function(b,a){var c=h(a),d=!1;c.each(function(){if("SCRIPT"==this.tagName)return d=!0,!1});d?c.each(function(){if("SCRIPT"==this.tagName){var a=h(this);I.compile(this.id,a.html(),a.attr("type")||I.defaultEngine)}}):I.compile(b,a,I.defaultEngine)},buildDependencies:"parseDependsTag"},url:function(b){return I.templateIdToUrl(k.fileName(b))}});k("html","template",{url:function(b){return b}});
if(h.render&&h.templates){var yb;I.engineAdapter("jsrender",yb={render:function(b,a,c){h.render[b]||this.compile(b,da.getElementById(b).innerHTML);return h.render[b](a,c)},compile:function(b,a){h.templates(b,{markup:a,debug:yb.templateDebugMode,allowCode:yb.allowCodeInTemplate})},isTemplateLoaded:function(b){return!!h.render[b]||!!da.getElementById(b)},templateDebugMode:!1,allowCodeInTemplate:!0});var tc=h.views.tags;tc({ts:function a(){return a.enabled?"<span style='color:red' data-sub='show:/*ts'>updated on:"+
(+new Date+"").substring(7,10)+"</span>":""},get:function(){var a=this.ctx.e.publisher;return a.get.apply(a,arguments)},prop:function(){var a=this.tagCtx.view.index;l(a)&&(a=this.ctx.e.publisher.count()-1);a=this.ctx.e.publisher.cd(a);return a.get.apply(a,arguments)},fixedRowId:function(){return"/"+this.ctx.modelPath+".table."+this.ctx.e.publisher.itemKey(this.tagCtx.view.data)},rowId:function(){var a=this.tagCtx.view.index,c=this.ctx.modelPath;l(a)&&(a=this.ctx.e.publisher.count()-1);return"/"+c+
"."+a},modelPath:function(){return"/"+this.ctx.modelPath}});tc.ts.render.enabled=!0;j("*ts",!1)}var F=C.Handlebars;l(F)||(j.template.engineAdapter("handlebars",{render:function(a,c,d){return F.partials[a](c,{data:{renderContext:d}})},compile:function(a,c){F.registerPartial(a,F.compile(c))},isTemplateLoaded:function(a){return!!F.partials[a]}}),F.registerHelper("modelPath",function(a){return a.data.renderContext.modelPath}),F.registerHelper("rowId",function(a){return"/"+a.data.renderContext.modelPath+
"."+a.data.index+";"}),F.registerHelper("fixedRowId",function(a){a=a.data.renderContext;return"/"+a.modelPath+".table."+a.e.publisher.itemKey(this)}),F.registerHelper("get",function(){var a=arguments,c=a.length-1,d=a[c].data.renderContext;return d.get.apply(d,y.call(a,0,c))}),F.registerHelper("prop",function(){var a=[].slice,c=arguments,d=c.length-1,f=c[d].data,f=f.renderContext.e.publisher.cd(f.index);return f.get.apply(f,a.call(c,0,d))}),h(function(){h("script[type=handlebars]").each(function(){F.registerPartial(this.id,
F.compile(h(this)[0].innerHTML))})}));var ua=[{name:"textBoxOrDropDown",initialize:function(a,c){c&&("SELECT"==a[0].tagName?a.children().each(function(){if(this.value==c)return h(this).attr("selected","selected"),!1}):a.attr("value",c))},get:function(a){return a.val()},set:function(a,c){a.val()!==c&&a.val(c)},match:D},{name:"checkbox",initialize:function(a,c){c&&a.attr("checked","checked")},get:function(a){a=a[0];var c=a.value;return"true"==c?!0:"false"==c?!1:"on"!==c?c:a.checked},set:function(a,
c){var d=a[0];d.checked=ea(c)?c:c==d.value},match:function(a){return a.is(":checkbox")}},{name:"radio",initialize:function(a,c){c==a[0].value&&a.attr("checked","checked")},get:function(a,c){if("resetVal"==c.type&&!c.publisher.attr("checked"))c.abort();else{var d=a[0],f=d.value;return"true"==f?!0:"false"==f?!1:"on"!==f?f:d.checked}},set:function(a,c,d){a=a[0];a.name||(a.name=d.publisher.path);a.checked=P.toString(c)==a.value},match:function(a){return a.is(":radio")}},{name:"listBox",initialize:function(a,
c){a.children().each(function(){c.contains(this.value)&&h(this).attr("selected","selected")})},get:function(a){var c=[];a.children("option:selected").each(function(){c.push(this.value)});return c.length?c:null},set:function(a,c){a.children().each(function(){this.selected=!(!c||!c.contains(this.value))})},match:function(a){return a.is("select[multiple]")}}];j.activity.get.getViewValue=function(a){return a.handler.getViewValue(a.publisher,a)};j.activity.set.setViewValue=function(a,c){return c.handler.setViewValue(this,
a,c)};j.workflow({updateViewValue:{initialize:function(a,c,d,f){$b(a,c,d,f,"set")},get:"get",set:"*setViewValue"},updateModelValue:{initialize:function(a,c,d,f){$b(c,a,d,f,"get")},get:"*getViewValue",set:"set"}});j.valueAdapter=function(a){if(a)ua.push(a);else return ua};z({val:function(a,c,d,f){var g,h,j;(f=f||"")?(f=f.split(","),h=f[0]||"change",g=f[1],j=f[2]):h="change";(!g||"view"==g)&&d.appendSub(a,c,"init1 after*","*updateViewValue",j);(!g||"model"==g)&&d.prependSub(c,a,h+" resetVal","*updateModelValue",
j)}});n.confirmMessage="Are you sure?";j.activity.get.compareTruthy=function(a){var c=a.handler.options;a=a.publisher;return l(c)?!a.isEmpty():a.compare(c)};j.activity.initialize.extractClass=function(a,c,d,f){a=f.split(",");d.className=a[0];d.options=a[1]};var uc={options:["!init after*:.|*options",{get:function(a){var c=a.handler.options,d=this.val();this.children("option[listItem]").remove().end().append(function(){var d="";h(a.publisher.get()).each(function(){d+="<option listItem='1' value='"+
c.value(this)+"'>"+c.name(this)+"</option>"});return d}).val(d);this.val()!==d&&h(this.trigger("change"))},initialize:function(a,c,d,f){if(f){a=f.split(",");var g=a[0],h=a[1]||a[0];d.options={name:function(a){return a[g]},value:function(a){return a[h]}}}else d.options={name:function(a){return a.toString()},value:function(a){return a.toString()}}}}],show:["!init after*:.|*show",{get:"*compareTruthy",set:function(a){this[a?"show":"hide"]()}}],hide:["!init after*:.|*hide",{get:"*compareTruthy",set:function(a){this[a?
"hide":"show"]()}}],enable:["!init after*:.|*enable",{get:"*compareTruthy",set:function(a){this.attr("disabled",!a)}}],disable:["!init after*:.|*disable",{get:"*compareTruthy",set:function(a){this.attr("disabled",a)}}],addClass:["!init after*:.|*addClass",{initialize:"*extractClass",get:"*compareTruthy",set:function(a,c){this[a?"addClass":"removeClass"](c.handler.className)}}],removeClass:["!init after*:.|*removeClass",{initialize:"*extractClass",get:"*compareTruthy",set:function(a,c){this[a?"removeClass":
"addClass"](c.handler.className)}}],toggleClass:["!init after*:.|*toggleClass",{get:function(a){var c,d,f=a.publisher.get(),g=a.handler.options;g&&(g.startsWith("!")&&(d=!0,g=g.substr(1)),c=f^d?"addClass":"removeClass");if("init"==a.type)if(g)this[c](g);else this.addClass(f);else if(g)this[c](g);else this.removeClass(a.removed).addClass(f)}}],focus:["!init after*:.|*focus",{get:"*compareTruthy",set:function(a){if(a){var c=this;V(function(){c.focus().select()},1)}}}],count:["!init after*:.|*count",
function(a){a=a.publisher.get();this.text("length"in a?a.length:a)}],dump:["!init *:.|*dump",function(a){a.type.startsWith("before")||this.html("<span style='color:red'>"+a.publisher.path+" : "+a.publisher.toJSON()+"</span>")}],alert:["$click:.|*alert",function(a){dd(l(a.handler.options)?this.get():a.handler.options)}],log:["$click:.|*log",function(a){j.log(l(a.handler.options)?this.get():a.handler.options)}],preventDefault:["$click:_|*preventDefault",function(a){a.preventDefault()}],stopPropagation:["$click:_|*stopPropagation",
function(a){a.stopPropagation()}],confirm:[function(a,c,d,f){j.sub(c,a,"click","*confirm",f)},function(a){var c=l(a.handler.options)?this&&this.path&&this.get&&this.get()||n.confirmMessage:a.handler.options;ed(c)||(a.stopImmediatePropagation(),a.preventDefault&&a.preventDefault())}],setTo:["$click:.|*setTo",{initialize:function(a,c,d,f){d.setTo=Ga(f)},get:function(a){this.set(a.handler.setTo)}}],"0":["$click:.|*0",function(){this.set(0)}],emptyString:["$click:.|*empty",function(){this.set("")}],"null":["$click:.|*null",
function(){this.set(null)}],"true":["$click:.|*true",function(){this.set(!0)}],"++":["$click:.|*++",function(){this.set(this.get()+1)}],"--":["$click:.|*--",function(){this.set(this.get()-1)}],"false":["$click:.|*false",function(){this.set(!1)}],toggle:["$click:.|*toggle",function(){this.set(!this.get())}],sortItems:["$click:.|*sortItems",{initialize:function(a,c,d,f){f=(f||"")&&f.split(",");d.by=f[0];d.asc=!!f[1]},get:function(a){a=a.handler;this.sort(a.by,a.asc);a.asc=!a.asc}}],clear:["$click:.|*clear",
function(){this.clear()}],del:["$click:.|*del;confirm:_|_Do you want to delete this item?",function(){this.del()}]},Ya;for(Ya in uc){var vc=uc[Ya];z(Ya,vc[0]);j.workflow(Ya,vc[1])}z({caption:function(a,c,d,f){h(a).prepend("<option value=''>"+(f||j.get(c)||"")+"</option>")},autofocus:function(a){V(function(){h(a).focus()},1)},mapEvent:function(a,c,d,f){f=f.split(",");h(a).mapEvent(f[0],f[1],f[2])},mapClick:function(a,c,d,f){f=f.split(",");h(a).mapEvent("click",f[0],f[1])},logPanel:function(a,c,d){h(a).css("list-style-type",
"decimal").css("font-family","monospace, serif");d.appendSub(a,"*log","init",function(a){a=a.publisher.get();for(var c=0;c<a.length;c++)this.append("<li>"+a[c]+"</li>")});d.appendSub(a,"*log","afterCreate.1",function(a){this.append("<li>"+a.originalPublisher.raw()+"</li>")});d.appendSub(a,"*log","afterCreate",function(){this.empty()})},clearlog:"clear:/*log",enableLater:"!after*:.|*enable",disableLater:"!after*:.|*disable",html:"!init after*:.|get html *toString",text:"!init after*:.|get text *toString",
removeIfDel:"!duringDel:.|*fakeGet remove",emptyIfDel:"!duringDel:.|*fakeGet empty"});j.newJqEvent({enter:["keyup",function(a){return 13===a.keyCode}],esc:["keyup",function(a){return 27===a.keyCode}],ctrlclick:["click",function(a){return a.ctrlKey}]});var Hd={create:"POST",update:"PUT",destroy:"DELETE",fetch:"GET"},B={detached:0,unchanged:1,added:3,deleted:4,modified:5};j.onAddOrUpdateNode(function(a,c,d){d instanceof j.Entity&&(d.__state===B.detached&&(d.__state=B.added),l(j(a).get("__entityContainer"))&&
(j.sub(a,a,"afterUpdate.*",Oc),j(a).set("__entityContainer",!0)))});j.Entity=j.Class.extend({__state:B.detached,create:function(){if(this instanceof j){if(this.get("__state")==B.added)return Ua(this,"create");throw"entity is not a new item";}return this.constructor.create(this)},fetch:function(){return this instanceof j?Ua(this,"fetch"):this.constructor.fetch(this)},update:function(){if(this instanceof j){if(this.get("__state")==B.modified)return Ua(this,"update")}else return this.constructor.update(this)},
destroy:function(){if(this instanceof j){var a=this;return Ua(this,"destroy").done(function(){a.del()})}return this.constructor.destroy(this)},save:function(){if(this instanceof j){var a=this.get("__state");if(a==B.added)return this.get("create");if(a==B.modified)return this.get("update")}else throw"not supported";}},{state:B,create:function(a){return this.ajax("create",a)},update:function(a){return this.ajax("update",a)},destroy:function(a){return this.ajax("destroy",a)},fetch:function(a){if(a)return this.ajax("fetch",
a);var c=this;return this.ajax("fetch").pipe(function(a){return h(c.list(a)).each(function(){this.__state=B.unchanged}).get()})},getUrl:function(a,c){var d=this.url||c.url,f=c&&c.id;return f?d+("/"===d.charAt(d.length-1)?"":"/")+encodeURIComponent(f):d},ajax:function(a,c){var d=Hd[a],d={type:d,dataType:"json",url:this.getUrl(a,c),contentType:"GET"==d?null:"application/json",processData:!1,data:"GET"==d?null:JSON.stringify(c)};return h.ajax(d).done(function(a){c&&p(c,a)})}});p(M,{save:function(){return this.get("save")},
destroy:function(){return this.get("destroy")},fetch:function(){return this.get("fetch")}});n.errors={defaultError:"Please enter a valid value"};var Da=W.invalidPaths=[],Va=j("*invalidPaths"),dc=/^\s*$/,wc=/^\d+$/,Id=/Invalid|NaN/,Jd=/^(\/(\\[^\x00-\x1f]|\[(\\[^\x00-\x1f]|[^\x00-\x1f\\\/])*\]|[^\x00-\x1f\\\/\[])+\/[gim]*)(,(.*))*$/,Ja=/([^,]+)(,(.*))?/,xc=/(\w+),(\w+)(,(.*))?/;j.validator=function(a){if(x(a)){for(var c=0;c<a.length;c++)j.validator(a[c]);return this}c=a.name;if(j.workflow(c))throw"validator name '"+
c+"' collide with name in hm.workflowTypes";a.error&&(n.errors[c]=a.error);a.isValid instanceof A&&(a.isValid=bc(a.isValid));var d="v_"+c;j.workflow(d,Pc(a));z(c,"!afterUpdate checkValidity:.|*"+d)};j.workflow({checkValidity:function(a){j.checkValidity(this.path)||a.stopImmediatePropagation()},warn:function(a){a.publisher.isEmpty()?this.removeClass("error").next("span.error").remove():this.addClass("error").next("span.error").remove().end().after("<span class='error'>"+a.publisher.get()+"</span>")},
highlightError:function(a){this[a.publisher.isEmpty()?"removeClass":"addClass"]("error")},renderErrorSummary:j.template.newTemplateHandler(function(a){return[a.publisher.getErrors()]})});z({validator:function(a,c,d,f){if(!f)throw"missing validator path";f.startsWith("#")||(f="#"+f);j(c).validator(f)},checkValidity:function(a,c,d){d.prependSub(c,a,"click","*checkValidity")},resetValidity:"$click:.|*fakeGet resetValidity",warn:"!after*:*errors|*warn",highlightError:"!after*:*errors|*highlightError",
warnSummary:"!afterUpdate* validityChecked:.|*renderErrorSummary;!validityReset:.|empty"});z("form",function(a,c,d){d.appendSub(c,a,"reset","*fakeGet resetValidity")},!0);j.subscription.special.validityChanged={setup:function(a,c){var d=c+"*isValid";l(j.get(d))&&j.sub(c,"*invalidPaths","!after*. after*.1",function(){var a=ac(c);j.get(d)!==a&&(j.trigger(c,c,"validityChanged",a,!a),j.set(d,a))})}};p(M,{checkValidity:function(a){a=this.getPath(a);ec(a,function(a){w(a,a,"checkValidity",q.get(a))});var c=
ac(a);j.trigger(a,a,"validityChecked",c);return c},validator:function(a,c){var d,f;if(t(a))for(d in a)this.cd(d).validator(a[d]);else if(r(a)||m(a)&&a.startsWith("#"))m(a)&&(a=this.raw(a.substr(1))),j.handle(this.path,"afterUpdate* checkValidity",function(c){var d=c.publisher,f=a.previousError;null===c.proposed||c.proposed===s||dc.test(c.proposed)?f&&(d.removeError(f),a.previousError=""):(c=a(d.get()),!1===c&&(c=n.errors.defaultError),m(c)?c!=f&&(d.addError(c),f||d.removeError(f),a.previousError=
c):f&&(d.removeError(f),a.previousError=""))});else if(m(a))j.handle(this.path,"afterUpdate* checkValidity","*v_"+a,c);else if(x(a))for(d=0;d<a.length;d++)f=a[d],x(f)?this.validator(f[0],f[1]):this.validator(f);return this},resetValidity:function(){cc(this.path);Q(this.get())||ec(this.path,cc);j.trigger(this.path,this.path,"validityReset")},addError:function(a){this.createIfUndefined("*errors",[]).cd("*errors").pushUnique(a);Va.pushUnique(this.path);return this},removeError:function(a){var c=this.createIfUndefined("*errors",
[]).cd("*errors");c.removeItem(a);c.isEmpty()&&Va.removeItem(this.path);return this},getErrors:function(){var a,c=this.path,d,f=[];for(a=0;a<Da.length;a++)if(d=Da[a],d==c||d.startsWith(c))f=f.concat(j.get(d+"*errors"));return f}});j.checkValidity=function(a){return q.checkValidity(a)};j.onDeleteNode(function(a){Va.removeItem(a)});j.validator.defaultErrorBuilder=Y;j.validator.buildRegexFn=bc;j.validator([{name:"required",error:"This field is required.",isValid:D},{name:"email",error:"Please enter a valid email address.",
isValid:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i},
{name:"url",error:"Please enter a valid URL.",isValid:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},
{name:"date",error:"Please enter a valid date.",isValid:function(a){return!Id.test((new Date(a)).toString())}},{name:"dateISO",error:"Please enter a valid date (ISO).",isValid:/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/},{name:"number",error:"Please enter a valid number.",isValid:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/},{name:"digits",error:"Please enter only digits.",isValid:wc},{name:"creditcard",error:"Please enter a valid credit card number.",isValid:function(a){if(/[^0-9\-]+/.test(a))return!1;var c=
0,d=0,f=!1;a=a.replace(/\D/g,"");for(var g=a.length-1;0<=g;g--){d=a.charAt(g);d=parseInt(d,10);if(f&&9<(d*=2))d-=9;c+=d;f=!f}return 0===c%10}},{name:"minlength",error:"Please enter at least {minlength} characters.",isValid:function(a,c){return a.length>=c.minlength},initialize:function(a,c,d,f){var g;if(f&&(g=Ja.exec(f)))d.options={minlength:+g[1],error:g[3]};else throw"invalid options for minlength validator";},buildError:Y},{name:"maxlength",error:"Please enter no more than {maxlength} characters.",
isValid:function(a,c){return a.length<=c.maxlength},initialize:function(a,c,d,f){var g;if(f&&(g=Ja.exec(f)))d.options={maxlength:+g[1],error:g[3]};else throw"invalid options for maxlength validator";},buildError:Y},{name:"rangelength",error:"Please enter a value between {minlength} and {maxlength} characters long.",isValid:function(a,c){return a.length>=c.minlength&&a.length<=c.maxlength},initialize:function(a,c,d,f){var g;if(f&&(g=xc.exec(f)))d.options={minlength:+g[1],maxlength:+g[2],error:g[4]};
else throw"invalid options for rangelength validator";},buildError:Y},{name:"min",error:"Please enter a value greater than or equal to {min}.",isValid:function(a,c){return a>=c.min},initialize:function(a,c,d,f){var g;if(f&&(g=Ja.exec(f)))d.options={min:+g[1],error:g[3]};else throw"invalid options for min validator";},buildError:Y},{name:"max",error:"Please enter a value less than or equal to {max}.",isValid:function(a,c){return a<=c.max},initialize:function(a,c,d,f){var g;if(f&&(g=Ja.exec(f)))d.options=
{max:+g[1],error:g[3]};else throw"invalid options for max validator";},buildError:Y},{name:"range",error:"Please enter a value between {min} and {max}.",isValid:function(a,c){return a>=c.min&&a<=c.max},initialize:function(a,c,d,f){var g;if(f&&(g=xc.exec(f)))d.options={min:+g[1],max:+g[2],error:g[4]};else throw"invalid options for range validator";},buildError:Y},{name:"equal",error:"Please enter the same value again.",isValid:function(a,c){return q.get(c.comparePath)===a},initialize:function(a,c,
d,f){var g;if(f&&(g=Ja.exec(f)))c=a.cd(g[1]).path,d.options={comparePath:c,error:g[3]},a.sub(c,"afterUpdate",function(){this.isEmpty()||w(this.path,this.path,"checkValidity",this.get())});else throw"invalid options for equal validator";}},{name:"regex",error:"Please enter a value match with required pattern.",isValid:function(a,c){return c.regex.test(a)},initialize:function(a,c,d,f){var g;if(f&&(g=Jd.exec(f)))d.options={regex:eval(g[1]),error:g[5]};else throw"invalid options for regex validator";
}},{name:"fixedValue",error:'Please enter value "{fixedValue}"',isValid:function(a,c){return a==c.fixedValue},initialize:function(a,c,d,f){if(m(f)){if(a=/^(\w+)(,(.*))*$/.exec(f))d.options={fixedValue:Ga(a[1]),error:a[3]}}else if(t(f))d.options=f;else{if(l(f))throw"missing options in fixedValue validator";d.options={fixedValue:f}}},buildError:Y}]);var Qc=j.workflow("v_required").get;j.workflow({addRowView:ta("*getOriginal",function(a,c){var d=this.children();if(0===d.length)this.append(a);else{var f=
+c.originalPublisher.pathIndex();0===f?d.eq(0).before(a):d.eq(f-1).after(a)}}),updateRowView:ta("*getOriginal",function(a,c){this.children().eq(+c.originalPublisher.pathIndex()).replaceWith(a)}),removeRowView:function(a){this.children().eq(+a.originalPublisher.pathIndex()).remove()}});M.enableQuery=function(a){function c(){var a=k.ops,c=k.by,f=k.value,g;if(f){if(a)if("equals"==a)g=A("^"+f+"$","i");else throw"operator does not supported";else g=A(f,"i");j=c?function(){return g.test(this[c])}:function(){if(t(this)){for(var a in this)if(g.test(this[a]))return!0;
return!1}return g.test(this)};s.set(!0);d.refreshQuery()}else j&&(j=null,s.set(!1),d.refreshQuery())}if(this.get("*query"))return this;var d,f,g,j,k,l=this.get(),m=this.cd("*query"),n=this.cd("*queryResult"),p=this.cd("*hasQueryResult"),q=m.cd("pager"),r=m.cd("filter"),s=r.cd("enabled"),w=m.cd("sort");(a=!!a)&&n.watch(m.path);n.watch(this.path);this.extend("*",d={autoQuery:a,hasQueryResult:!1,query:{pager:g={enabled:!1,index:0,count:1,size:0},sort:f={by:null,asc:null},filter:k={by:"",value:"",ops:"",
enabled:!1},enabled:function(){return this.get("pager.enabled")||this.get("sort.by")||this.get("filter.enabled")}},queryResult:function(a){var c=h(l),c=j?c.filter(j).get():c.get();p.update(0<c.length);f.by&&c.sortObject(f.by,f.asc);!a&&g.enabled&&(a=Math.ceil(c.length/g.size)||1,a!=g.count&&(g.count=a,g.index>g.count-1&&(g.index=0),m.change("pager")),c=c.slice(g.index*g.size,(g.index+1)*g.size));return c},refreshQuery:function(){d.autoQuery||V(function(){n.trigger("afterUpdate")},0)},paging:function(a){a=
a.eventData;wc.test(a)?a=+a:"next"==a?a=g.index+1:"previous"==a?a=g.index-1:"first"==a?a=0:"last"==a?a=g.count-1:"disabled"==a&&(a=0,d.resetPaging());if("number"!==typeof a||0>a||a>g.count-1)a=0;q.update("index",a);d.refreshQuery()},resetSort:function(a){w.set("by",null).set("asc",null);!0!==a&&d.refreshQuery()},resetSearch:function(a){r.update("by","").update("value","").update("ops","");!0!==a&&d.refreshQuery()},resetPaging:function(a){q.update("enabled",!1).update("size",0).update("count",1).update("index",
0);!0!==a&&d.refreshQuery()},resetQuery:function(){d.resetSort(!0);d.resetSearch(!0);d.resetPaging(!0);d.refreshQuery()}});r.cd("by").handle("afterUpdate",c);r.cd("value").handle("afterUpdate",c);r.cd("ops").handle("afterUpdate",c);return this};z({listView:"tmplOnChange:.;!afterCreate.1:.|*addRowView;!afterUpdate.1:.|*updateRowView;!afterDel.1:.|*removeRowView",enableQuery:function(a,c,d,f){j(c).enableQuery(!!f)},queryView:"tmplOnAnyChange:*queryResult",sortQuery:"$click:*query.sort.by|*setTo;$click:*query.sort.asc|*toggle;$click:*refreshQuery",
resetSort:"$click:*resetSort;show:*query.sort.by",search:"$click:*refreshQuery;enable:*query.filter.enabled",resetSearch:"$click:*resetSearch;show:*query.filter.enabled",resetQuery:"$click:*resetQuery;show:*query.enabled",searchBox:"ns:*query.filter.value;val:.|enter;$esc:.|*null",pager:"tmplOnAnyChange:*query.pager;show:*hasQueryResult|_;$paging:*paging;preventDefault:.",setPage:"true:*query.pager.enabled;enable:*query.pager.size;$click:*refreshQuery",page:function(a,c,d,f){if(!f)throw"pageIndex is missing";
h(a).mapEvent("click","paging",f)},showFound:"show:*hasQueryResult",hideFound:"hide:*hasQueryResult"});j.onAddOrUpdateNode(function(a,c,d){if(x(d)){var f=d;l(f)?f=[]:x(f)||(f=[f]);if(!f.table||!f.guid)f.table={},f.guid=0;for(var f=f.table,g=0;g<d.length;g++)f[d.guid++]=d[g];a=j(a).cd(c);c=a.cd("table");c.sub(a,"afterCreate.1",Sc);c.sub(a,"afterUpdate.*",Rc);c.sub(a,"afterDel.1",Tc);a.sub(c,"afterDel.1",Uc);a.sub(c,"afterUpdate.1",Vc)}});M.itemKey=function(a){var c,d;d=this.raw();r(d)&&(d=this.main().get());
if(d=d.table)for(c in d)if(a===d[c])return c};M.keyAt=function(a){return this.itemKey(this.get(a))};h.Event.prototype.selectedRowIndex=function(){return this.publisher.children().filter(this.originalPublisher.parents()).index()};kb.prototype={item:null,mode:function(){var a=this.get(),c=a.selectedIndex;return null===a.item?"read":l(c)?"update":-1==c?"new":"update"}};p(M,{initShadowEdit:function(a){var c=this;if(!c.get("*edit")){var d=c.path,f=A("^"+d.replace(".","\\.")+"\\*edit\\.item[^*]+\\*$"),
g=A("^"+d.replace(".","\\.")+"\\*edit\\.item[\\w.]+\\*edit\\.item");if(l(a))if(c.isShadow()&&!r(c.raw())){a=c.main();var h=(a.logicalPath()+"*edit.item").length+1,d=O(d).substr(h);a=va(a.get("*edit.itemTemplate."+d+".0"),!0)}else a=r(c.raw())?q.raw(c.main().path+"_itemTemplate"):q.raw(d+"_itemTemplate"),l(a)&&(a=qb(va(c.get()[0],!0)));d=new kb(-1);d.itemTemplate=a;d.item=null;c.set("*edit",d);c.cd("*edit.selectedIndex").handle("afterUpdate",function(a){var d=a.proposed;a=a.removed;0<=d?c.trigger("beginInRowUpdate",
d):-1==d&&c.trigger("cancelInRowUpdate",a)});c.cd("*edit.item").handle("afterUpdate",function(){var a,c;for(a in W)if(c=P.toLogicalPath("__hm."+a),g.test(c))delete W[a];else if(f.test(c)&&(c=W[a].edit))c.item=null,c.selectedIndex=-1});return this}},newShadowItem:function(){"read"!==this.get("*edit.mode")&&this.resetShadowItem();var a=this.cd("*edit"),c=a.raw("itemTemplate"),c=r(c)?c():va(c,!0);a.update("item",c);a.change("mode")},editShadowItem:function(a,c){var d=this.raw();if(Q(d)||t(d)){var f=
this.get("*edit");l(f)&&(f=new kb,this.set("*edit",f));null===f.item&&(this.set("*edit.item",va(d,!0)),this.change("*edit.mode"))}else"read"!==this.get("*edit.mode")&&this.resetShadowItem(),l(c)?c=this.indexOf(a):a=this.get()[c],d=this.cd("*edit"),f=d.raw("itemTemplate"),f=r(f)?f(a):va(a,!0),d.update("item",f).update("selectedIndex",c),d.change("mode")},resetShadowItem:function(a){if(this.path.endsWith(".edit.item"))return this.main().resetShadowItem();var c=this.raw();Q(c)||t(c)?(this.set("*edit.item",
null),this.change("*edit.mode")):(c=this.cd("*edit"),l(c.get())||(c.update("item",null),a?c.get().selectedIndex=-1:c.update("selectedIndex",-1),c.change("mode")))},saveShadowItem:function(){if(this.path.endsWith(".edit.item"))return this.main().saveShadowItem();var a=this.raw();if(Q(a)||t(a))this.set(this.get("*edit.item")).set("*edit.item",null),this.change("*edit.mode");else{var c=this.get("*edit.mode"),d=this.get("*edit.item");if("read"==c)throw"invalid operations";"new"==c?(r(a)?this.main().push(d):
this.push(d),this.resetShadowItem()):(c=this.get("*edit.selectedIndex"),r(a)?(a=this.get(),this.main().replaceItem(a[c],d)):this.replaceItem(a[c],d),this.resetShadowItem(!0))}}});j.workflow({newShadowItem:"*fakeGet newShadowItem",editShadowItem:function(a){"editRow"==a.type?this.editShadowItem(null,a.selectedRowIndex()):this.path.endsWith(".edit.item")?this.main().editShadowItem(this.get()):this.editShadowItem();a.stopPropagation()},removeItem:function(a){"read"!=this.get("*edit.mode")&&this.resetShadowItem();
var c=a.selectedRowIndex(),d=this.raw();r(d)?(d=this.get(),this.main().removeItem(d[c])):this.removeAt(c);a.stopPropagation()},moveUpItem:function(a){var c=a.selectedRowIndex();this.move(c,c-1);a.stopPropagation()},moveDownItem:function(a){var c=a.selectedRowIndex();this.move(c,c+1);a.stopPropagation()},renderNewView:ta(function(a){if("new"==a.publisher.get())return a.publisher.main().get("*edit.item")}),renderUpdateRowView:ta(function(a){return a.publisher.get("*edit.item")},function(a,c){this.children().eq(c.proposed).replaceWith(a)}),
destroyUpdateRowView:function(a){a.publisher.change(a.proposed)},saveShadowItem:function(a){this.saveShadowItem();a.stopPropagation()},resetShadowItem:function(a){this.resetShadowItem();a.stopPropagation()}});z({shadowEdit:"!init:.|initShadowEdit *fakeSet;deleteRow:.;$editRow:.|*editShadowItem",shadowEditInRow:"shadowEdit:.;!beginInRowUpdate:.|*renderUpdateRowView;!cancelInRowUpdate:.|*destroyUpdateRowView",deleteRow:"$deleteRow:.|*confirm|_Do you want to delete this item?;$deleteRow:.|*removeItem;",
movableRow:"$moveUp:.|*moveUpItem;$moveDown:.|*moveDownItem;",newItemView:"!afterUpdate:*edit.mode|*renderNewView;showOnNew:.",showOnNew:"show:*edit.mode|_new",hideOnNew:"hide:*edit.mode|_new",editItemView:"tmplOnChange:*edit.item;showOnEdit:.",displayItemView:"tmplOnChange:.;hideOnEdit:.",showOnEdit:function(a,c,d){d.appendSub(a,c+"*edit.mode","init afterUpdate",function(a){a=a.publisher.get();this[l(a)||"read"==a?"hide":"show"]()})},hideOnEdit:function(a,c,d){d.appendSub(a,c+"*edit.mode","init afterUpdate",
function(a){a=a.publisher.get();this[l(a)||"read"==a?"show":"hide"]()})},newItem:"$click:.|*newShadowItem;hideOnNew:.",editObject:"$click:.|*editShadowItem;hideOnEdit:.",saveEdit:"$click:.|*saveShadowItem",cancelEdit:"$click:.|*resetShadowItem"});j.newJqEvent({editRow:["click",function(a){return h(a.target).hasClass("editRow")}],deleteRow:["click",function(a){return h(a.target).hasClass("deleteRow")}],moveUp:["click",function(a){return h(a.target).hasClass("moveUp")}],moveDown:["click",function(a){return h(a.target).hasClass("moveDown")}]});
n.hashPrefix="!";n.routePrefix="/";var zb=[],ga,yc,Wc=/\+/g,Xc=/\[/,Yc=/\]$/,Zc=/\]$/,$c=/^([^?]*)(\?.*)?$/,ad=/^[^?]*\?(.*)$/,lb,xa=[];j.routeParams=function(){var a,c,d=arguments,f=Wa(Fa());for(a=0;a<d.length;a++)c=d[a],c in f&&q.set(c,f[c]),j.sub(null,c,"afterUpdate",bd),xa.push(d[a]);return this};M.routeParams=function(a){var c=this;j.routeParams.apply(j,h.map(a?arguments:[""],function(a){return c.getPath(a)}));return c};j.routePath=function(a,c){var d=a.split("/");zb.push(d);c&&(ga=d);var f=
Ea();hc(f,d,!0)&&(yc=!0)};j.updateRoute=function(){var a,c,d=Ea(),f=Wa(Fa());if(d)for(a=0;a<zb.length&&!hc(d,zb[a]);a++);else if(ga){d=[];for(a=0;a<ga.length;a++){var g=ga[a];if(m(g))d.push(g);else{var h=q.get(g[0])+"";d.push(h||g.defaultValue||"")}}d=d.join("/")}for(c in f)xa.contains(c)&&q.set(c,f[c]);for(a=0;a<xa.length;a++)c=xa[a],f[c]=q.get(c);ic(d,f)};h(C).bind("hashchange",j.updateRoute);h(function(){var a,c="";if(ga&&!yc){c=[];for(a=0;a<ga.length;a++){var d=ga[a];d.startsWith(":")?c.push(q.get(d.substr(1))+
""):c.push(d)}c=c.join("/")}else c=Ea();d=Wa(Fa());for(a=0;a<xa.length;a++){var f=xa[a];d[f]=q.get(f)}ic(c,d)});n.selectedClass="selected";n.tabViewAttr="tab-view";n.tabLinkAttr="tab-link";n.tabContainerNameAttr="tab-container-name";j.workflow({selectTab:function(a){var c=this.attr(n.tabViewAttr)||this.attr(n.tabLinkAttr),d=a.handler.options;a.publisher.get()==c?this.addClass(d):this.removeClass(d)},selectTabInContainer:function(a){var c=a.publisher.get(),d=n.tabViewAttr,f=n.tabLinkAttr;a=a.handler.options;
var g=a.selectedClass;this.find(a.selector).andSelf().each(function(a,j){var k=h(j);(k.attr(d)||k.attr(f))==c?k.addClass(g):k.removeClass(g)})}});z({tab:function(a,c,d,f){f=f||n.selectedClass;d.appendSub(a,c,"init afterUpdate","*selectTab",f);h(a).attr(n.tabLinkAttr)&&d.appendSub(c,a,"click",kc,n.tabLinkAttr)},tabContainer:function(a,c,d,f){f=(f||"").split(",");var g=n.tabLinkAttr,h=n.tabContainerNameAttr,j=f[0];f=f[1];j=j?"["+h+"='"+j+"']":"";h="["+g+"]"+j;j=h+",["+n.tabViewAttr+"]"+j;d.appendSub(c,
a,"click",kc,g,h);d.appendSub(a,c,"init100 afterUpdate","*selectTabInContainer",{selector:j,selectedClass:f||n.selectedClass})}});var Kd=/\./g,ha={},Ld=/^([^,]+)(,(.+))?$/,zc=/^([^,]+)(,([^,]+))?(,(.+))?$/;j.App=j.Class.extend({initialize:function(a){if(!a.name)throw"An app must have a name.";this.callBase("initialize",a)},load:function(a,c,d){if(a&&this.loadable()){var f=this,g,j=f.name;ya.get(a[0],j)||(f.loadModel&&(g=f.loadModel(c,d)),d=function(){f.loadView(a,c);ya.add(a[0],c.path,j,f);a.bind("exitApp."+
j,function(a){f.unload(h(this));a.stopPropagation()});f.instanceCount++;f.uid++},$(g)?g.done(d):d())}},unload:function(a){var c=this.name,d=ya.get(a[0],c);this.unloadView(a);this.unloadModel(d.modelNode);ya.remove(a[0],c);a.unbind("exitApp."+c);this.instanceCount--},getInitialData:null,loadModel:function(a,c){var d=this;if(!d.getInitialData)throw"app.getInitialData is not implemented";var f=d.getInitialData(a,c);if($(f))return f.done(function(c){d.getModelNode(a).set(c)});d.getModelNode(a).set(f)},
unloadModel:function(a){this.loadModel&&j.del(a)},loadView:function(a,c){var d=this.getModelNode(c).path,f=h("<div></div>").attr("appname",this.name).attr("ns",d);f.hmData("ns",d);f.appendTo(a).tmpl(this.getTemplateOptions(),d)},unloadView:function(a){a.find("> [appname='"+this.name+"']").remove()},getTemplateOptions:function(){return this.templateOptions||this.name},getModelNode:function(a){var c=this.subPath||this.name.replace(Kd,"_");this.uid&&(c+=this.uid);return a.cd(c)},instanceCount:0,uid:0,
loadable:D,templateOptions:null,subPath:null},{add:function(a){a instanceof this||(a=this(a));ha[a.name]=a},remove:function(a){ha[a]&&!ha[a].instanceCount&&delete ha[a]},get:function(a){return ha[a]},loadDefinition:function(a){return k.load(a+".app")},loadApp:function(a,c,d,f){1==arguments.length?(c=h(da.body),d=q):2==arguments.length&&(d=q);var g=ha[a];g?g.load(c,d,f):this.loadDefinition(a).done(function(){ha[a].load(c,d,f)})},unloadApp:function(a,c){l(a)&&(a=c,c=h("body"));var d=ya.get(c,a);d&&
d.app.unload(c)}});var ya={get:function(a,c){return this.appData(a)[c]},add:function(a,c,d,f){this.appData(a)[d]={app:f,modelNode:f.getModelNode(j(c)),modelContainer:c}},remove:function(a,c){delete this.appData(a)[c]},appData:function(a,c){var d=h(a).hmData("app");!c&&!d&&(d={},h(a).hmData("app",d));return d}};z({app:function(a,c,d,f){d=Ld.exec(h.trim(f));f=d[3];j.App.loadApp(d[1],h(a),j(c),f)},exitApp:function(a,c,d,f){h(a).mapEvent("click","exitApp."+f)},loadApp:function(a,c,d,f){d=zc.exec(h.trim(f));
var g=d[1],k=h(d[3]),l=d[5];h(a).click(function(){j.App.loadApp(g,k,j(c),l)})},unloadApp:function(a,c,d,f){c=zc.exec(h.trim(f));var g=c[1],k=h(c[3]);h(a).click(function(){j.App.unloadApp(g,k)})}});var Md=h.cleanData;h.cleanData=function(a){h(a).each(function(){var a=ya.appData(this,!0);if(a)for(var d in a){var f=a[d];delete a[d];f.unload(this,!0)}});Md(a)};k("app","js",{url:function(a){a=k.fileName(a);return a.startsWith("apk.")?"apk/"+a.substr(4)+"/main.js":"app/"+a+".js"}})})(jQuery,window);
